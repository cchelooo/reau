<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js with 3D Models</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.0/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
        <!-- Marcador personalizado -->
        <a-marker preset="hiro" id="hiroMarker">
            <!-- Cargamos un modelo 3D .gltf sobre el marcador -->
            <a-entity
                id="gltfModel"
                gltf-model="url(scene.gltf)"
                scale="0.1 0.1 0.1"
                position="0 0 0">
            </a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Seleccionamos el marcador y el modelo
        const marker = document.querySelector("#hiroMarker");
        const model = document.querySelector("#gltfModel");
        let isSmall = false; // Variable para alternar entre tamaños
        let isManualScaling = false; // Variable para saber si se está usando escala manual
        let intervalId; // Para guardar el intervalo de actualización de tamaño

        // Función para actualizar el tamaño según la distancia del marcador
        function updateScaleBasedOnDistance() {
            const markerPosition = marker.object3D.position.length(); // Distancia del marcador a la cámara
            const scaleFactor = Math.min(Math.max(markerPosition / 5, 0.1), 1); // Ajusta el tamaño según la distancia
            model.setAttribute('scale', `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
        }

        // Evento para ajustar el tamaño según la distancia del marcador
        marker.addEventListener("markerFound", () => {
            intervalId = setInterval(() => {
                if (!isManualScaling) {
                    updateScaleBasedOnDistance(); // Solo actualiza si no se está usando el tamaño manual
                }
            }, 100); // Actualiza cada 100ms
        });

        marker.addEventListener("markerLost", () => clearInterval(intervalId)); // Detiene cuando el marcador se pierde

        // Escucha el evento de clic para dispositivos táctiles y mouse
        document.addEventListener('click', () => {
            toggleScale(); // Llama a la función para cambiar el tamaño
        });

        // Alternar entre grande y pequeño
        function toggleScale() {
            isManualScaling = true; // Activa el modo de escala manual
            const currentScale = model.getAttribute('scale'); // Obtiene el tamaño actual
            const scaleX = parseFloat(currentScale.x); // Convertimos los valores de escala a números
            const scaleY = parseFloat(currentScale.y);
            const scaleZ = parseFloat(currentScale.z);

            if (isSmall) {
                // Si es pequeño, lo agrandamos (doblamos el tamaño actual)
                model.setAttribute('scale', `${scaleX * 2} ${scaleY * 2} ${scaleZ * 2}`);
            } else {
                // Si es grande, lo reducimos al 50% del tamaño actual
                model.setAttribute('scale', `${scaleX * 0.5} ${scaleY * 0.5} ${scaleZ * 0.5}`);
            }
            isSmall = !isSmall; // Cambia el estado de la variable para alternar
        }
    </script>
</body>
</html>
